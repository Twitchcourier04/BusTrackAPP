function getLocation() {
  navigator.geolocation
    ? navigator.geolocation.getCurrentPosition(showPosition)
    : console.log("Geolocation is not supported by this browser.");
}
var uLat, uLng;
function showPosition(o) {
  (uLat = o.coords.latitude), (uLng = o.coords.longitude);
  L.marker([uLat, uLng]).addTo(mymap);
}
!(function () {
  var o = L.Marker.prototype._initIcon,
    t = L.Marker.prototype._setPos,
    n = "msTransform" === L.DomUtil.TRANSFORM;
  L.Marker.addInitHook(function () {
    var o =
      this.options.icon &&
      this.options.icon.options &&
      this.options.icon.options.iconAnchor;
    o && (o = o[0] + "px " + o[1] + "px"),
      (this.options.rotationOrigin =
        this.options.rotationOrigin || o || "center bottom"),
      (this.options.rotationAngle = this.options.rotationAngle || 0),
      this.on("drag", function (o) {
        o.target._applyRotation();
      });
  }),
    L.Marker.include({
      _initIcon: function () {
        o.call(this);
      },
      _setPos: function (o) {
        t.call(this, o), this._applyRotation();
      },
      _applyRotation: function () {
        this.options.rotationAngle &&
          ((this._icon.style[L.DomUtil.TRANSFORM + "Origin"] =
            this.options.rotationOrigin),
          n
            ? (this._icon.style[L.DomUtil.TRANSFORM] =
                "rotate(" + this.options.rotationAngle + "deg)")
            : (this._icon.style[L.DomUtil.TRANSFORM] +=
                " rotateZ(" + this.options.rotationAngle + "deg)"));
      },
      setRotationAngle: function (o) {
        return (this.options.rotationAngle = o), this.update(), this;
      },
      setRotationOrigin: function (o) {
        return (this.options.rotationOrigin = o), this.update(), this;
      },
    });
})(),
  getLocation();
var mymap = L.map("mapid").setView([13.9147415, 100.6435692], 16);
L.tileLayer(
  "https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiaW5ubmVhbmciLCJhIjoiY2p3Yzlkdmg1MDBvMDQ5bnBlaXV3OGFycyJ9.4J6Br9eq-Yck6JyXqV1k8Q",
  {
    attribution:
      'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
    maxZoom: 18,
    id: "mapbox.streets",
    accessToken: "your.mapbox.access.token",
  }
).addTo(mymap);
var dataR,
  greenIcon = L.icon({
    iconUrl: "bus.png",
    iconSize: [38, 50],
    iconAnchor: [19, 25],
    popupAnchor: [-3, -76],
  }),
  overlays = Object,
  BusSelect = 0;
function getBus(o) {
  $.ajax({
    type: "GET",
    url: "https://localhost:8000/track/" + o,
    crossDomain: !0,
    success: function (t) {
      0 != BusSelect
        ? (BusSelect.remove(), console.log("removedone"))
        : console.log("notremove");
      var n = [];
      (dataR = t).forEach((o) => {
        n.push(
          L.marker([o.lat, o.lng], {
            icon: greenIcon,
            rotationAngle: o.direction,
          })
        );
      }),
        console.log(n);
      var i = L.layerGroup(n);
      (overlays[o] = i),
        (BusSelect = L.control.layers(null, overlays).addTo(mymap));
    },
    dataType: "json",
  });
}
getBus("a3"),
  getBus("73k"),
  getBus("54"),
  getBus("204"),
  getBus("73"),
  getBus("204"),
  getBus("13"),
  getBus("514");
